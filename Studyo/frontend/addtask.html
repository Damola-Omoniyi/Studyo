<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Studyo</title>
</head>
<body>
<h1>Studyo</h1>

<form id ="task">
    <input type="text" id="taskName" name="taskName" placeholder="Task Name" required /> <br><br>
    <input type="date" id="startDate" name="startDate"  required /> <br><br>
    <input type="date" id="deadline" name="deadline" required /> <br><br>
    <select id="urgency" name="urgency" required>
        <option value ="" disabled selected>Urgency</option>
        <option value ="High">High</option>
        <option value ="Medium">Medium</option>
        <option value ="Low">Low</option>
    </select> <br><br>

    <textarea id="description" name="description" placeholder="Task Description" required></textarea>
    <br><br>
    <button type="submit">Create Task</button>
</form>
</body>
<script>
const username = localStorage.getItem('username');
const form = document.getElementById('task');

form.addEventListener('submit', async(event) => {
    event.preventDefault();
    const taskData = {
        taskName: document.getElementById('taskName').value,
        startDate: document.getElementById('startDate').value,
        deadline: document.getElementById('deadline').value,
        urgency: document.getElementById('urgency').value,
        description: document.getElementById('description').value,
        username: username
    };

    try {
        const response = await fetch("http://127.0.0.1:8000/api/create-task/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: 'include',
            body: JSON.stringify(taskData)
        });

        const result = await response.json();
        alert(JSON.stringify(result));

        if (response.ok){
         window.location.href = 'index.html';
        }
        alert("Task created successfully: " + JSON.stringify(result));
    } catch(err) {
        alert("Task creation failed: " + err.message);
    }
});

</script>
</html>